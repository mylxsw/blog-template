<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/styles/modern.css">
    <link rel="alternate" type="application/rss+xml" title="{{site.title}} RSS Feed" href="/rss.xml">
    <!-- Highlight.js theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: { 500: '#6366F1', 600: '#4F46E5', 700: '#4338CA' },
              accent: { 400: '#38BDF8', 500: '#0EA5E9' }
            }
          }
        }
      }
    </script>
</head>
<body class="theme-modern theme-light antialiased">
    <header class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <a href="/" class="navbar-logo">{{site.title}}</a>
            </div>
            <div class="navbar-right">
                <button type="button" class="theme-toggle" data-theme-toggle aria-label="切换为暗色模式">
                    <span class="theme-toggle-icon" data-theme-icon>🌙</span>
                </button>
                <nav class="navbar-menu" id="navbar-menu">
                    <div class="navbar-nav">
                        <a href="/" class="nav-item">
                            <span class="nav-text">首页</span>
                        </a>
                        <a href="/about.html" class="nav-item">
                            <span class="nav-text">关于</span>
                        </a>
                        <a href="/rss.xml" class="nav-item nav-item-special" target="_blank" rel="noopener noreferrer">
                            <span class="nav-text">RSS</span>
                        </a>
                    </div>
                </nav>
            </div>
            <button class="navbar-toggle" id="navbar-toggle" aria-label="切换导航菜单">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <article class="article-container">
            <div class="article-header">
                <h1 class="article-title">{{title}}</h1>
                <div class="article-meta">
                    <div class="flex items-center space-x-2">
                        <time datetime="{{dateISO}}">{{dateFormatted}}</time>
                    </div>
                    {{#if tags}}
                    <div class="flex flex-wrap gap-2">
                        {{#tags}}
                        <span class="post-tag">{{.}}</span>
                        {{/tags}}
                    </div>
                    {{/if}}
                </div>
                {{#if coverImage}}
                <div class="article-cover">
                    <img src="{{coverImage}}" alt="{{title}}" class="article-cover-image" loading="lazy" onerror="this.onerror=null;this.src='/assets/placeholder.svg';this.classList.add('placeholder');">
                </div>
                {{/if}}
            </div>
            <div class="article-content">
                {{{content}}}
            </div>
        </article>
    </main>
    <footer class="footer">
        <div class="max-w-6xl mx-auto px-4">
            <p>&copy; {{site.copyrightYear}} {{site.title}}. All rights reserved.</p>
            <p class="mt-2"><a href="/rss.xml" class="text-accent-400 hover:text-accent-500">📡 订阅 RSS</a></p>
        </div>
    </footer>
    <script>
        // 导航菜单、主题切换与代码复制
        document.addEventListener('DOMContentLoaded', function() {
            // 图片加载失败占位符
            document.querySelectorAll('img').forEach(img => {
                img.addEventListener('error', function() {
                    if (this.dataset.fallbackApplied) return;
                    this.dataset.fallbackApplied = '1';
                    this.src = '/assets/placeholder.png';
                    this.classList.add('placeholder');
                }, { once: true });
            });

            const navbarToggle = document.getElementById('navbar-toggle');
            const navbarMenu = document.getElementById('navbar-menu');

            if (navbarToggle && navbarMenu) {
                navbarToggle.addEventListener('click', function() {
                    navbarToggle.classList.toggle('open');
                    navbarMenu.classList.toggle('open');
                });

                // 点击菜单项后关闭菜单
                const navItems = navbarMenu.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', function() {
                        navbarToggle.classList.remove('open');
                        navbarMenu.classList.remove('open');
                    });
                });

                // 点击菜单外部关闭菜单
                document.addEventListener('click', function(e) {
                    if (!navbarToggle.contains(e.target) && !navbarMenu.contains(e.target)) {
                        navbarToggle.classList.remove('open');
                        navbarMenu.classList.remove('open');
                    }
                });
            }

            // 复制代码：事件委托
            document.body.addEventListener('click', async (e) => {
                const btn = e.target.closest('.copy-code-btn');
                if (!btn) return;
                const container = btn.closest('.code-block');
                if (!container) return;
                const codeEl = container.querySelector('pre code');
                if (!codeEl) return;
                const text = codeEl.innerText;
                try {
                    await navigator.clipboard.writeText(text);
                    const original = btn.textContent;
                    btn.textContent = '已复制';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = original;
                        btn.classList.remove('copied');
                    }, 1200);
                } catch (err) {
                    // 回退方案
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    try { document.execCommand('copy'); } catch {}
                    document.body.removeChild(textarea);
                    const original = btn.textContent;
                    btn.textContent = '已复制';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = original;
                        btn.classList.remove('copied');
                    }, 1200);
                }
            });

            // 主题切换
            const themeToggleButtons = document.querySelectorAll('[data-theme-toggle]');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

            const applyTheme = (theme, persist = true) => {
                const isDark = theme === 'dark';
                document.body.classList.toggle('theme-dark', isDark);
                document.body.classList.toggle('theme-light', !isDark);
                document.body.setAttribute('data-theme', theme);
                themeToggleButtons.forEach(button => {
                    const icon = button.querySelector('[data-theme-icon]');
                    if (icon) {
                        icon.textContent = isDark ? '🌞' : '🌙';
                    }
                    button.setAttribute('aria-label', isDark ? '切换为亮色模式' : '切换为暗色模式');
                });
                if (persist) {
                    localStorage.setItem('theme', theme);
                }
            };

            const storedTheme = localStorage.getItem('theme');
            if (storedTheme) {
                applyTheme(storedTheme, false);
            } else {
                applyTheme(prefersDark.matches ? 'dark' : 'light', false);
            }

            themeToggleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const nextTheme = document.body.classList.contains('theme-dark') ? 'light' : 'dark';
                    applyTheme(nextTheme, true);
                });
            });

            prefersDark.addEventListener('change', (event) => {
                if (!localStorage.getItem('theme')) {
                    applyTheme(event.matches ? 'dark' : 'light', false);
                }
            });
        });
    </script>
</body>
</html>
